<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="favicon.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Blog Post - 건축사사무소밤" />

    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://parkjoohyung.github.io/bam-architect/blog-post.html" />
    <meta property="og:title" content="Blog Post - 건축사사무소밤" />
    <meta property="og:description" content="View our latest architectural works and news." />
    <meta property="og:image" content="https://parkjoohyung.github.io/bam-architect/og-image.png" />

    <title>Blog - 건축사사무소밤</title>
</head>

<body>
    <div id="app">
        <!-- Header -->
        <header class="site-header">
            <div class="container header-inner">
                <a href="./" class="logo">건축사사무소밤</a>
                <nav class="desktop-nav">
                    <a href="projects.html">Projects</a>
                    <a href="blog.html">Blog</a>
                    <a href="news.html">News</a>
                    <a href="contact.html">Contact</a>
                </nav>
                <button class="mobile-toggle" aria-label="Toggle Menu">
                    <span class="bar"></span>
                    <span class="bar"></span>
                </button>
            </div>
        </header>

        <!-- Main Content -->
        <main>
            <article class="post-container section" style="padding-top: 180px;">
                <div class="container" style="max-width: 800px;">
                    <!-- Content will be injected here by JS -->
                    <div id="post-content">
                        <header class="post-header fade-in-up">
                            <span class="blog-date" id="post-date"></span>
                            <h1 id="post-title">Loading...</h1>
                        </header>
                        <div class="post-body fade-in-up" id="post-body" style="animation-delay: 0.1s;">
                            <!-- Body content -->
                        </div>
                    </div>
                    <div class="post-nav fade-in-up"
                        style="margin-top: 4rem; padding-top: 2rem; border-top: 1px solid var(--color-border);">
                        <a href="blog.html" class="btn-link">← Back to List</a>
                    </div>
                </div>
            </article>
        </main>

        <!-- Footer -->
        <footer class="site-footer">
            <div class="container">
                <div class="footer-grid">
                    <div class="footer-col">
                        <h3>건축사사무소밤</h3>
                    </div>
                    <div class="footer-col">
                        <h4>Contact</h4>
                        <p>p.juhyung@daum.net</p>
                        <p>010-5891-1031</p>
                    </div>
                    <div class="footer-col">
                        <h4>Social</h4>
                        <a href="#">Instagram</a>
                        <a href="#">LinkedIn</a>
                    </div>
                </div>
                <div class="footer-bottom">
                    <p>&copy; 2026 건축사사무소밤. All rights reserved.</p>
                </div>
            </div>
        </footer>
    </div>
    <script type="module">
        import { marked } from 'https://cdn.jsdelivr.net/npm/marked/lib/marked.esm.js';
        import '/src/main.js';

        async function loadPost() {
            const urlParams = new URLSearchParams(window.location.search);
            const postId = urlParams.get('id');

            if (!postId) {
                document.getElementById('post-content').innerHTML = '<h1>Invalid URL</h1>';
                return;
            }

            try {
                // 1. Get index to find filename
                const indexRes = await fetch('posts.json'); // Changed to relative path
                const posts = await indexRes.json();
                const postMeta = posts.find(p => p.id === postId);

                if (!postMeta) {
                    throw new Error('Post not found in index');
                }

                // 2. key info
                document.getElementById('post-title').innerText = postMeta.title;
                document.getElementById('post-date').innerText = postMeta.date;
                document.title = `${postMeta.title} - 건축사사무소밤`;

                // Update Meta Description for SEO
                let metaDesc = document.querySelector('meta[name="description"]');
                if (!metaDesc) {
                    metaDesc = document.createElement('meta');
                    metaDesc.name = 'description';
                    document.head.appendChild(metaDesc);
                }
                metaDesc.content = `${postMeta.title} - ${postMeta.date}`;

                // 3. Load Markdown
                const mdRes = await fetch(`posts/${postMeta.filename}`); // Changed to relative path
                if (!mdRes.ok) throw new Error('Markdown file not found');
                const mdText = await mdRes.text();

                // 4. Clean Content
                // - Remove Logseq attributes (lines with '::')
                // - Remove leading dashes from Outliner format (e.g. "- ## Title" -> "## Title")
                const cleanMd = mdText.split('\n')
                    .filter(line => !line.includes('::'))
                    .map(line => line.replace(/^\s*-\s?/, '')) // Remove leading dash and optional space
                    .join('\n');

                // 5. Render
                document.getElementById('post-body').innerHTML = marked.parse(cleanMd);

                // 6. Navigation (Previous / Next)
                // posts array is sorted by date (newest first)
                // index 0: newest
                // index N: oldest
                const currentIndex = posts.findIndex(p => p.id === postId);

                // Newer post (index - 1) -> Next Post (Wait, traditionally Next is newer, Prev is older? Or Next Page is older?)
                // Let's use explicit labels "이전 글 (Older)", "다음 글 (Newer)" or just Titles.
                // Standard convention: "Previous" = Newer (Left), "Next" = Older (Right) sometimes.
                // Let's use: < Previous (Newer) | Next (Older) > 
                // Wait, usually "Previous Post" implies chronologically previous (Older).
                // Let's just use "이전글", "다음글" and see.

                // If sorted by Date DESC:
                // i-1 is NEWER
                // i+1 is OLDER

                const newerPost = posts[currentIndex - 1]; // To be shown as '다음글' (Next / Newer) or '이전글'?
                const olderPost = posts[currentIndex + 1]; // To be shown as '이전글' (Previous / Older)

                // Let's stick to standard reversed chronological blog:
                // Left: Newer Post (다음글 usually means Next in list, which is older... ambiguous)
                // Let's use "이전글(Older)" and "다음글(Newer)" ? 
                // Actually, "Next" usually means "Next to read" which could be the next chronological one.
                // Let's just calculate them and render.

                const navContainer = document.querySelector('.post-nav');
                navContainer.innerHTML = `
                    <div class="nav-links">
                        ${olderPost ? `<a href="blog-post.html?id=${olderPost.id}" class="nav-item prev">
                            <span class="nav-label">이전글</span>
                            <span class="nav-title">${olderPost.title}</span>
                        </a>` : '<div></div>'}
                        
                        ${newerPost ? `<a href="blog-post.html?id=${newerPost.id}" class="nav-item next">
                            <span class="nav-label">다음글</span>
                            <span class="nav-title">${newerPost.title}</span>
                        </a>` : '<div></div>'}
                    </div>
                    <div style="text-align: center; margin-top: 2rem;">
                         <a href="blog.html" class="btn-link">목록으로</a>
                    </div>
                `;

            } catch (error) {
                console.error(error);
                document.getElementById('post-content').innerHTML = `<h1>Post not found</h1><p>${error.message}</p>`;
            }
        }

        document.addEventListener('DOMContentLoaded', loadPost);
    </script>
    <style>
        .blog-date {
            display: block;
            font-family: var(--font-body);
            color: var(--color-text-muted);
            margin-bottom: 1rem;
        }

        .post-header h1 {
            font-size: 2.5rem;
            margin-bottom: 3rem;
            line-height: 1.2;
        }

        .post-body p {
            font-size: 1.1rem;
            line-height: 1.8;
            margin-bottom: 1.5rem;
            color: var(--color-text-main);
        }

        /* Navigation Styles */
        .nav-links {
            display: flex;
            justify-content: space-between;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            text-decoration: none;
            color: var(--color-text-main);
            padding: 1rem;
            border: 1px solid var(--color-border);
            border-radius: 4px;
            width: 48%;
            transition: background-color 0.2s;
        }

        .nav-item:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .nav-item.next {
            text-align: right;
            align-items: flex-end;
        }

        .nav-label {
            font-size: 0.8rem;
            color: var(--color-text-muted);
            margin-bottom: 0.5rem;
        }

        .nav-title {
            font-weight: 500;
            display: -webkit-box;
            -webkit-line-clamp: 1;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .btn-link {
            display: inline-block;
            padding: 0.5rem 1rem;
            border: 1px solid var(--color-border);
            text-decoration: none;
            color: var(--color-text-muted);
            transition: all 0.2s;
        }

        .btn-link:hover {
            border-color: var(--color-text-main);
            color: var(--color-text-main);
        }

        @media (max-width: 768px) {
            .post-header h1 {
                font-size: 1.8rem;
            }

            .nav-links {
                flex-direction: column;
            }

            .nav-item {
                width: 100%;
                text-align: left !important;
                align-items: flex-start !important;
            }
        }
    </style>
</body>

</html>